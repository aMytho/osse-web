<app-header text="Settings"></app-header>


<div class="bg-slate-500/15 rounded-lg px-4 pb-4 text-white">
  <!-- Tab headers -->
  <div class="flex flex-wrap border-b border-white mb-4 bg-emerald-300/5 -mx-4" role="tablist">
    <button class="px-4 py-2 text-white transition-all duration-200 font-semibold"
      [ngClass]="{'bg-emerald-500/30': activeTab === 'scan'}" (click)="activeTab = 'scan'" role="tab"
      [attr.aria-selected]="activeTab == 'scan'" aria-controls="tab-scan" id="label-scan">
      Scan
    </button>
    <button class="px-4 py-2 text-white transition-all duration-200 font-semibold"
      [ngClass]="{'bg-emerald-500/30': activeTab === 'preferences'}" (click)="activeTab = 'preferences'" role="tab"
      [attr.aria-selected]="activeTab == 'preferences'" aria-controls="tab-preferences" id="label-preferences">
      Preferences
    </button>
    <button class="px-4 py-2 text-white transition-all duration-200 font-semibold"
      [ngClass]="{'bg-emerald-500/30': activeTab === 'logs'}" (click)="activeTab = 'logs'" role="tab"
      [attr.aria-selected]="activeTab == 'logs'" aria-controls="tab-logs" id="label-logs">
      Logs
    </button>
  </div>
  @if (activeTab === 'scan') {
  <div class="space-y-4" role="tabpanel" aria-labelledby="label-scan" id="tab-scan">
    <app-header [type]="2" text="Scan Tracks"></app-header>
    <p class="my-2 ml-2">You can start a track scan from the web GUI. This will scan the below directories as listed in
      your config.json file.</p>
    <ul class="mb-2 ml-4 list-disc list-inside">
      @for (dir of directories(); track $index) {
      <li class="my-1">{{dir}}</li>
      } @empty {
      <li class="my-1">No directories found...</li>
      }
    </ul>
    <div class="mt-2">
      <button class="btn btn-primary" [disabled]="scanInProgress() || waitingForScanConfirmation()"
        (click)="scan()">Start Scan</button>

      @if (waitingForScanConfirmation()) {
      <p class="animate-pulse font-semibold text-xl">Waiting for scan start confirmation...</p>
      }

      @if (scanInProgress()) {
      <p class="animate-pulse font-semibold text-xl mt-2">Scan in progress. This may take some time...</p>

      <div class="ml-2 mt-2">
        <label for="scan-progress">Scan Progress: </label>
        <progress id="scan-progress" [value]="scanProgress().finished_count" [max]="scanProgress().total_directories"
          class="rounded-xs overflow-hidden accent-emerald-400"></progress>

        @if (scanProgress().nextDir) {
        <p>Now scanning {{scanProgress().nextDir}}</p>
        }

        <p>Scanned {{scanProgress().finished_count}} of {{scanProgress().total_directories}} directories.</p>

        <p class="italic">While you can leave this page, we suggest waiting for the scan to finish before viewing your
          library. Some files may be missing metadata if the scan is incomplete.</p>

        <p class="my-2">You can cancel the scan, but any files scanned will remain in the database.</p>

        <button class="btn btn-warning" (click)="cancelScan()">Cancel Scan</button>
      </div>
      }

      @if (scanFailMessage()) {
      <p class="my-4 font-semibold text-xl text-red-500">{{scanFailMessage()}}</p>
      }

      @if (scanComplete()) {
      <p class="my-4 font-semibold text-xl text-green-500">Scan Complete! You can safely leave this page.</p>
      }
    </div>
  </div>
  } @else if (activeTab === 'preferences') {
  <div class="space-y-4" role="tabpanel" aria-labelledby="label-preferences" id="tab-preferences">
    <app-header [type]="2" text="Preferences"></app-header>

    <h3 class="divider">Background Image</h3>
    <p class="my-2 ml-2">
      When a track or album is playing, Osse will dispay the cover art in the background.
      This may cause contrast issues with certain covers. This can be disabled if you so choose.</p>

    <form #showBackgroundsForm="ngForm" (ngSubmit)="saveBackgroundCoverPreference()" class="ml-2 flex flex-col gap-y-4">
      <label class="label">
        <input type="checkbox" checked="checked" class="toggle toggle-primary" name="show-background-covers"
          id="show-background-covers" [checked]="showBackgrounds()" (input)="showBackgrounds.set(!showBackgrounds())" />
        Show background colors
      </label>

      <button type="submit" class="btn btn-primary w-min"
        [disabled]="!showBackgroundsForm.form.valid || false">Save</button>
    </form>

    <h3 class="divider">
      Visualizer
    </h3>

    <p class="my-2 ml-2">
      When a track is playing, Osse will dispay a music visualizer. This is generated in real-time.
      This may cause performance issues with certain devices. This can be disabled if you so choose.</p>

    <form #visualizerForm="ngForm" (ngSubmit)="saveVisualizerPreference()" class="ml-2 flex flex-col gap-y-4">
      <label class="label">
        <input type="checkbox" checked="checked" class="toggle toggle-primary" name="show-visualizer"
          id="show-visualizer" [checked]="showVisualizer()" (input)="showVisualizer.set(!showVisualizer())" />
        Enable visualiser
      </label>

      <div class="w-full max-w-xs">
        <label for="test">Visualizer Samples</label>
        <input type="range" min="1" max="10" value="1" class="range range-secondary" step="1" #samples
          name="visualizer-samples" id="visualizer-samples" [value]="visualizerSamples()" />
        <div class="flex justify-between px-2.5 mt-2 text-xs">
          <span>|</span>
          <span>|</span>
          <span>|</span>
          <span>|</span>
          <span>|</span>
          <span>|</span>
          <span>|</span>
          <span>|</span>
          <span>|</span>
          <span>|</span>
        </div>
        <div class="flex justify-between px-2.5 mt-2 text-xs">
          <span>1</span>
          <span>2</span>
          <span>3</span>
          <span>4</span>
          <span>5</span>
          <span>6</span>
          <span>7</span>
          <span>8</span>
          <span>9</span>
          <span>10</span>
        </div>
      </div>

      <button type="submit" class="btn btn-primary w-min" [disabled]="!visualizerForm.form.valid || false">Save</button>
    </form>
  </div>
  } @else if (activeTab === 'logs') {
  <div class="space-y-4" role="tabpanel" aria-labelledby="label-logs" id="tab-logs">
    <app-settings-logs></app-settings-logs>
  </div>
  }
</div>
